//! Ingredient density data for volume-to-weight conversion.
//!
//! Densities are stored as grams per US cup (236.588 ml).
//! Data sourced from USDA FoodData Central (public domain, CC0).
//! Generated by scripts/usda-import/import_usda.py

use std::collections::HashMap;
use std::sync::LazyLock;

/// Volume conversion factors to cups (the reference unit for density data).
pub const CUPS_PER_TBSP: f64 = 1.0 / 16.0;
pub const CUPS_PER_TSP: f64 = 1.0 / 48.0;
pub const CUPS_PER_FL_OZ: f64 = 1.0 / 8.0;
pub const CUPS_PER_PINT: f64 = 2.0;
pub const CUPS_PER_QUART: f64 = 4.0;
pub const CUPS_PER_GALLON: f64 = 16.0;
pub const CUPS_PER_ML: f64 = 1.0 / 236.588;
pub const CUPS_PER_L: f64 = 1000.0 / 236.588;

/// Ingredient density data: canonical name -> grams per cup.
pub static DENSITY_DATA: LazyLock<HashMap<&'static str, f64>> = LazyLock::new(|| {
    let mut m = HashMap::new();

    m.insert(
        "albertsons granulated sugar, granulated white (ca2) - nfy040y31",
        188.0,
    );
    m.insert("all-purpose flour", 125.0);
    m.insert("almond flour", 96.0);
    m.insert("almonds, dry roasted, salted, blue diamond", 137.0);
    m.insert("almonds, dry roasted, salted, emerald", 130.0);
    m.insert("almonds, dry roasted, salted, great value", 132.0);
    m.insert("almonds, dry roasted, salted, snack artist", 138.0);
    m.insert("almonds, dry roasted, salted, store brand", 131.0);
    m.insert("beans, snap, canned, drained, del monte", 132.0);
    m.insert("beans, snap, canned, drained, great value", 128.0);
    m.insert("beans, snap, canned, drained, store brand", 131.0);
    m.insert(
        "beans, snap, green, canned, regular pack, drained solids",
        129.0,
    );
    m.insert(
        "best choice sugar, granulated white (mo1) - nfy040y33",
        184.0,
    );
    m.insert("bread flour", 127.0);
    m.insert("broccoli, pass 2, region 1, ar1, nfy010d0m", 76.0);
    m.insert("broccoli, pass 2, region 4, pa2, nfy010d0e", 114.0);
    m.insert("broccoli, raw", 76.0);
    m.insert("brown sugar", 220.0);
    m.insert("butter", 227.0);
    m.insert("c&h granulated white sugar (ok1) - nfy040y38", 187.2);
    m.insert("c&h, sugar, granulated white (mo1) - nfy040y30", 192.0);
    m.insert("c&h, sugar, granulated, white (ca1) - nfy040y3d", 192.0);
    m.insert("c&h, sugar, granulated, white (ca2) - nfy040y35", 176.0);
    m.insert("c&h, sugar, granulated, white (co2) - nfy040y32", 175.0);
    m.insert("cake flour", 114.0);
    m.insert("cantaloupe, raw, pass 2, region 1, tn2, nfy010d0t", 158.0);
    m.insert(
        "cheddar cheese, sliced, cracker barrel (al1) - nfy120d3o",
        132.0,
    );
    m.insert("cheese, cheddar", 105.0);
    m.insert(
        "cheese, cheddar, mild, block/chunk, store brand, food lion   (nc1) nfy120xcw",
        244.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, kraft (ga1) nfy120wes",
        97.6,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, kraft (ia) nfy120wee",
        121.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, kraft (in1) nfy120wea",
        99.3,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, kraft (ky1) nfy120wek",
        108.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, kraft (nc1) nfy120wew",
        96.7,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, kraft (ne1) nfy120wei",
        114.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, kraft (pa1) nfy120weo",
        95.8,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, essential everyday  (pa1) nfy120wff",
        96.4,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, fareway  (ia) nfy120wfj",
        94.5,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, food club (az1) nfy120wf4",
        106.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, great value (ca1) nfy120wgb",
        104.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, great value (ky1) nfy120wg7",
        99.2,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, great value (ne1) nfy120wfe",
        105.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, kroger (ca2) nfy120wfa",
        94.6,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, kroger (tx1) nfy120wgf",
        97.5,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, laura lynn (ga1) nfy120wgn",
        91.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, my essentials (nc1) nfy120wgj",
        98.8,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, schnucks (in1) nfy120wf6",
        98.2,
    );
    m.insert(
        "cheese, cheddar, natural shredded mild, store brand, wegmans (nj1) nfy120wf0",
        104.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (az1) nfy120wn4",
        111.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (ca1) nfy120wn8",
        102.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (ga1) nfy120wmw",
        99.6,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (ia) nfy120wnj",
        116.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (in1) nfy120wn0",
        112.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (ky1) nfy120wnn",
        98.1,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (nc1) nfy120wnc",
        97.3,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (ne1) nfy120wnv",
        103.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (pa1) nfy120wnr",
        102.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, kraft (tx1) nfy120wms",
        105.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, essential everyday (pa1) nfy120wop",
        110.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, fareway (ia) nfy120wof",
        120.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, food club (az1) nfy120wot",
        115.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, great value (ca1) nfy120wou",
        97.7,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, great value (ne1) nfy120woy",
        96.3,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, kroger (ca2) nfy120wnz",
        109.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, kroger (ky1) nfy120wp2",
        115.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, kroger (tx1) nfy120wo8",
        103.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, my essentials (nc1) nfy120wo3",
        112.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, publix (ga1) nfy120woh",
        120.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, schnucks (in1) nfy120wol",
        103.0,
    );
    m.insert(
        "cheese, cheddar, natural shredded sharp, store brand, shop rite (nj1) nfy120woc",
        125.0,
    );
    m.insert("cheese, cottage, lowfat, 2% milkfat", 220.0);
    m.insert("cheese, dry white, queso seco", 97.3);
    m.insert("cheese, mozzarella, low moisture, part-skim", 86.2);
    m.insert("cheese, parmesan, grated", 121.6);
    m.insert("cheese, ricotta, whole milk", 279.7);
    m.insert("cheese, ricotta, whole milk, galbani", 333.5);
    m.insert("cheese, ricotta, whole milk, lucerne", 309.0);
    m.insert("cheese, ricotta, whole milk, polly-o", 320.5);
    m.insert("cheese, ricotta, whole milk, sorrento", 297.5);
    m.insert("cheese, ricotta, whole milk, store/other", 314.5);
    m.insert(
        "chinese restaurant, fried rice (no meat) (al1) - nfy1209bq",
        143.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (ca1) - nfy1209cc",
        130.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (ca2) - nfy1209e1",
        142.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (co1) - nfy1209em",
        140.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (ct1) - nfy1209cm",
        108.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (in1) - nfy1209c5",
        134.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (mi1) - nfy1209dm",
        136.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (mo1) - nfy1209cl",
        117.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (nc1) - nfy1209d1",
        147.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (ny1) - nfy1209df",
        141.0,
    );
    m.insert(
        "chinese restaurant, fried rice (no meat) (ok1) - nfy1209e8",
        130.0,
    );
    m.insert("chorizo pork sausage, mixed brand, cooked", 208.0);
    m.insert("cocoa powder", 86.0);
    m.insert("coconut flour", 112.0);
    m.insert("coconut oil", 218.0);
    m.insert("cornstarch", 128.0);
    m.insert(
        "cottage cheese, 2% milkfat, breakstone (al1) - nfy120bst",
        210.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, breakstone (ct1) - nfy120bsx",
        219.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, breakstone (fl) - nfy120bt2",
        222.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, breakstone (in1) - nfy120bt5",
        216.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, breakstone (mi1) - nfy120bsv",
        220.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, breakstone (nc1) - nfy120bt3",
        224.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, breakstone (ok1) - nfy120bsz",
        220.0,
    );
    m.insert("cottage cheese, 2% milkfat, daisy (ca1) - nfy120bs9", 206.0);
    m.insert("cottage cheese, 2% milkfat, daisy (ca2) - nfy120bsb", 232.0);
    m.insert("cottage cheese, 2% milkfat, daisy (co1) - nfy120bsj", 204.0);
    m.insert("cottage cheese, 2% milkfat, daisy (ct1) - nfy120bsn", 214.0);
    m.insert("cottage cheese, 2% milkfat, daisy (fl1) - nfy120bsf", 221.0);
    m.insert("cottage cheese, 2% milkfat, daisy (in1) - nfy120bsl", 224.0);
    m.insert("cottage cheese, 2% milkfat, daisy (mi1) - nfy120bsh", 212.0);
    m.insert("cottage cheese, 2% milkfat, daisy (mo1) - nfy120bsr", 218.0);
    m.insert("cottage cheese, 2% milkfat, daisy (nc1) - nfy120bsd", 220.0);
    m.insert("cottage cheese, 2% milkfat, daisy (ny) - nfy120bsp", 218.0);
    m.insert(
        "cottage cheese, 2% milkfat, knudsen (ca1) - nfy120bte",
        234.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, knudsen (ca2) - nfy120btb",
        235.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, friendship (fl1) - nfy120btf",
        235.0,
    );
    m.insert("cottage cheese, 2% milkfat, store brand/other brand, friendship all natural (ny1) - nfy120bti", 212.0);
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, horizon organic (in1) - nfy120bt7",
        234.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, hy vee (mo1) - nfy120btx",
        232.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, hyvee (mo1) - nfy120btq",
        220.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, king soopers (co1) - nfy120btv",
        229.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, kraft (ct1) - nfy120btj",
        233.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, kraft simply (al1) - nfy120btt",
        222.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, kroger (mi1) - nfy120bt9",
        208.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, meadow gold viva (co1) - nfy120btm",
        225.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, safeway (ca1) - nfy120bto",
        204.0,
    );
    m.insert(
        "cottage cheese, 2% milkfat, store brand/other brand, sunnyside farms (ca2) - nfy120btz",
        200.0,
    );
    m.insert("cream cheese", 232.0);
    m.insert(
        "dixie crystals, sugar, granulated, white (nc1) - nfy040y2y",
        194.0,
    );
    m.insert(
        "domino sugar - premium pure cane, granulated white (al 1) - nfy040y3e",
        196.8,
    );
    m.insert(
        "domino sugar - premium pure cane, granulated white (ct1) - nfy040y2w",
        196.0,
    );
    m.insert(
        "domino sugar - premium pure cane, granulated white (fl1) - nfy040y6k",
        196.8,
    );
    m.insert(
        "domino sugar - premium pure cane, granulated white (in1) - nfy040y3h",
        177.6,
    );
    m.insert(
        "domino sugar - premium pure cane, granulated white (mi1) - nfy040y2x",
        196.0,
    );
    m.insert(
        "domino sugar - premium pure cane, granulated white (ny1) - nfy040y3b",
        200.0,
    );
    m.insert("dried egg yolk (without free-flow agent added)", 67.0);
    m.insert("dried stabilized egg white", 107.0);
    m.insert("dried whole egg (without free-flow agent added)", 85.0);
    m.insert(
        "dry white cheese, queso seco, cacique cotija (ca) - nfy0901hr",
        94.8,
    );
    m.insert(
        "dry white cheese, queso seco, cacique cotija (ca) - nfy0901hw",
        100.0,
    );
    m.insert(
        "dry white cheese, queso seco, cacique cotija (nm) - nfy0901gu",
        100.0,
    );
    m.insert(
        "dry white cheese, queso seco, don francisco cotija (ca) - nfy0901gy",
        115.0,
    );
    m.insert(
        "dry white cheese, queso seco, el mexicano (nv) - nfy0901f5",
        82.1,
    );
    m.insert(
        "dry white cheese, queso seco, el mexicano brand (ca) - nfy0901hl",
        87.7,
    );
    m.insert(
        "dry white cheese, queso seco, el mexicano brand (ca) - nfy0901hm",
        76.9,
    );
    m.insert(
        "dry white cheese, queso seco, la cremosita (md) - nfy0901em",
        86.6,
    );
    m.insert(
        "dry white cheese, queso seco, la fe cotija (fl) - nfy0901gq",
        95.5,
    );
    m.insert(
        "dry white cheese, queso seco, quesos la ricura limited (ny) - nfy0901f6",
        123.0,
    );
    m.insert(
        "dry white cheese, queso seco, quesos la ricura limited tm (tx) - nfy0901he",
        101.0,
    );
    m.insert(
        "dry white cheese, queso seco, quesos la ricura limited tm (tx) - nfy0901ka",
        104.0,
    );
    m.insert("egg, white, dried", 107.0);
    m.insert("egg, whole, dried", 85.0);
    m.insert("egg, yolk, dried", 67.0);
    m.insert("figs, dried, uncooked", 149.0);
    m.insert("granulated sugar", 200.0);
    m.insert(
        "grapefruit juice, white, canned or bottled, unsweetened",
        257.0,
    );
    m.insert("grapefruit juice, white, shelf stable, ocean spray", 222.0);
    m.insert(
        "grapefruit juice, white, shelf stable, signature kitchen",
        270.0,
    );
    m.insert("grapefruit juice, white, shelf stable, store brand", 260.0);
    m.insert("heavy cream", 238.0);
    m.insert("honey", 340.0);
    m.insert("hummus, commercial", 271.2);
    m.insert("hummus, other", 278.4);
    m.insert("hummus, sabra classic", 286.4);
    m.insert("hummus, tribe classic", 278.4);
    m.insert("kale, fresh, unprepared", 17.4);
    m.insert("kale, frozen, as purchased", 122.0);
    m.insert("kale, frozen, cooked, boiled, drained, without salt", 118.0);
    m.insert("kale, raw", 20.6);
    m.insert("kroger sugar, granulated white (in1) - nfy040y3g", 186.0);
    m.insert("kroger sugar, granulated white (mi1) - nfy040y36", 187.0);
    m.insert("liquid egg white (without whipping agents)", 243.0);
    m.insert("liquid egg yolk (plain, no salt or sugar)", 243.0);
    m.insert("liquid whole egg (plain, no salt or sugar)", 243.0);
    m.insert("maple syrup", 315.0);
    m.insert("melons, cantaloupe, raw", 158.0);
    m.insert("milk", 245.0);
    m.insert("milk, 1% (wave 22e)", 238.0);
    m.insert("milk, 2% (wave 22e)", 223.0);
    m.insert(
        "milk, lowfat, fluid, 1% milkfat, with added vitamin a and vitamin d",
        233.0,
    );
    m.insert(
        "milk, nonfat, fluid, with added vitamin a and vitamin d (fat free or skim)",
        229.0,
    );
    m.insert(
        "milk, reduced fat, fluid, 2% milkfat, with added vitamin a and vitamin d",
        227.0,
    );
    m.insert("milk, skim (wave 22e)", 222.0);
    m.insert("milk, whole (wave 22e)", 235.5);
    m.insert("milk, whole, 3.25% milkfat, with added vitamin d", 229.0);
    m.insert("mission figs, dried, region 1, tn2, nfy01014r", 149.0);
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (ca1) - nfy120cyi",
        86.8,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (ca2) - nfy120cyp",
        79.9,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (fl) - nfy120cy9",
        87.9,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (in1) - nfy120cyd",
        77.3,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (mi1) - nfy120cxt",
        77.0,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (mo1) - nfy120cy0",
        77.9,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (nc1) - nfy120cy5",
        74.1,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, kraft (ny) - nfy120cyl",
        94.0,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (al1) - nfy120cwz",
        85.0,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (ca1) - nfy120cx9",
        96.1,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (ca2) - nfy120cx1",
        93.4,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (co1) - nfy120cxd",
        90.5,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (ct1) - nfy120cx5",
        102.0,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (fl) - nfy120cxh",
        91.2,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (in1) - nfy120cxl",
        90.7,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (mi1) - nfy120cwj",
        93.3,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (mo1) - nfy120cwn",
        92.5,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (nc1) - nfy120cxp",
        95.6,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, sargento (ny) - nfy120cwv",
        90.4,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, americas choice  (ny) - nfy120czl",
        77.3,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, great value (al1) - nfy120d0d",
        77.9,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, hyvee (mo1) - nfy120cz9",
        85.0,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, kroger (in1) - nfy120czh",
        80.4,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, kroger (mi1) - nfy120czd",
        76.7,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, lucerne (ca1) - nfy120czx",
        80.8,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, lucerne (co1) - nfy120d05",
        79.8,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, my essentials (nc1) - nfy120czt",
        87.3,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, publix (fl) - nfy120czp",
        95.2,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, shop rite (ct1) - nfy120d01",
        90.7,
    );
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand, sunnyside farms  (ca2) - nfy120d09",
        90.9,
    );
    m.insert("mozzarella, low-moisture, part-skim, store brand/other brand, crystal farms (ct1) - nfy120cz1", 85.9);
    m.insert(
        "mozzarella, low-moisture, part-skim, store brand/other brand, kroger (co1) - nfy120cyt",
        75.2,
    );
    m.insert("mustard, prepared, yellow", 249.0);
    m.insert("nectarines, raw", 143.0);
    m.insert("nectarines, walmart, ar1, nf0008uh", 143.0);
    m.insert("nuts, almonds, dry roasted, with salt added", 135.0);
    m.insert("oil, coconut", 185.6);
    m.insert("oil, coconut, better body organic (ca2) nfy120pcc", 182.4);
    m.insert("oil, coconut, lou ana (al1) nfy120pcm", 188.8);
    m.insert("oil, coconut, lou ana (co1) nfy120pc7", 196.8);
    m.insert("oil, coconut, lou ana (ct1) nfy120pc9", 190.4);
    m.insert("oil, coconut, lou ana (fl) nfy120pch", 187.2);
    m.insert("oil, coconut, lou ana (in1) nfy120pco", 169.6);
    m.insert("oil, coconut, lou ana (mi1) nfy120pcq", 172.8);
    m.insert("oil, coconut, lou ana (mo1) nfy120pcf", 188.8);
    m.insert("oil, coconut, lou ana (nc1) nfy120pck", 206.4);
    m.insert("oil, coconut, lou ana (ok1) nfy120pcs", 179.2);
    m.insert("olive oil", 216.0);
    m.insert(
        "oranges, navel, pass 2, region 1, pricecutter   , mo2 - nfy0107ed",
        165.0,
    );
    m.insert("oranges, raw, navels", 165.0);
    m.insert(
        "oranges, raw, navels (includes foods for usda's food distribution program)",
        165.0,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (al1) - nfy120byo",
        107.2,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (al1) - nfy120byq",
        100.0,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (ca1) - nfy120bz4",
        115.2,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (ca2) - nfy120bz8",
        116.8,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (co1) - nfy120bz0",
        121.6,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (ct1) - nfy120bys",
        116.8,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (fl) - nfy120bzi",
        124.8,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (in1) - nfy120bzm",
        120.0,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (mi1) - nfy120byw",
        120.0,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (mo1) - nfy120bzq",
        115.2,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (nc1) - nfy120byk",
        115.2,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (ny) - nfy120bze",
        118.4,
    );
    m.insert(
        "parmesan cheese, grated, kraft 100% (ok1) - nfy120bzc",
        120.0,
    );
    m.insert("parmesan cheese, grated, store brand/other brand, flora fine foods 100% pure (fl) - nfy120c08", 132.8);
    m.insert(
        "parmesan cheese, grated, store brand/other brand, great value (al1) - nfy120c0i",
        123.2,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, great value (ok1) - nfy120c0g",
        121.6,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, hyvee 100% (mo1) - nfy120c04",
        123.2,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, kroger (in1) - nfy120c00",
        142.4,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, kroger (mi1) - nfy120bzw",
        132.8,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, my essentials 100% (nc1) - nfy120c0q",
        118.4,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, price chopper (ct1) - nfy120c0m",
        124.8,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, safeway kitchens (ca1) - nfy120c0y",
        115.2,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, safeway kitchens (co1) - nfy120c0u",
        116.8,
    );
    m.insert(
        "parmesan cheese, grated, store brand/other brand, sunnyside farms 100% (ca2) - nfy120c12",
        128.0,
    );
    m.insert("peaches, raw, pass 2, region 1, ar1, nfy010cig", 154.0);
    m.insert("peaches, yellow, raw", 154.0);
    m.insert("peanut butter", 258.0);
    m.insert("peanut butter, creamy, jif (ca1) - nfy120by4", 258.0);
    m.insert("peanut butter, creamy, skippy (nc1) - nfy120bwo", 258.0);
    m.insert("peanut butter, smooth style, with salt", 258.0);
    m.insert("pears, barlett, or/wa3, nfy0000kz", 150.5);
    m.insert(
        "pears, bartlett, pass 2, region 4, shopritesupermarket (store #33) , ny/nj1 - nfy0107eu",
        140.0,
    );
    m.insert("pears, raw, bartlett", 140.0);
    m.insert(
        "pears, raw, bartlett (includes foods for usda's food distribution program)",
        140.0,
    );
    m.insert("powdered sugar", 120.0);
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, ar - nfy020z4i",
        246.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, ca - nfy020yw8",
        250.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, il - nfy020z1i",
        244.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, mo - nfy020yt5",
        251.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, nj - nfy020z95",
        248.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, pa - nfy020z1d",
        250.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, pa - nfy020z6l",
        250.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, tn - nfy020yzi",
        253.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, tx - nfy020yzz",
        242.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, tx - nfy020z5g",
        245.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, wa - nfy020yyx",
        246.0,
    );
    m.insert(
        "prepared yellow mustard, frenchs classic yellow mustard, wa - nfy020z34",
        251.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, ar - nfy020z4k",
        243.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, ca - nfy020ywb",
        258.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, il - nfy020z1m",
        248.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, mo - nfy020z0s",
        246.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, nj - nfy020z97",
        239.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, pa - nfy020z1f",
        245.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, pa - nfy020z6n",
        249.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, tn - nfy020yzk",
        249.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, tx - nfy020z5j",
        242.0,
    );
    m.insert(
        "prepared yellow mustard, other brand, wa - nfy020z35",
        243.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, ar - nfy020z4j",
        253.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, ca - nfy020ywa",
        260.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, il - nfy020z1j",
        248.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, mo - nfy020z0r",
        252.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, nj - nfy020z96",
        250.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, pa - nfy020z1e",
        253.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, pa - nfy020z6m",
        257.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, tn - nfy020yzj",
        252.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, tx - nfy020z01",
        255.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, tx - nfy020z5h",
        261.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, wa - nfy020yyz",
        257.0,
    );
    m.insert(
        "prepared yellow mustard, store brand, wa - nfy020z3c",
        242.0,
    );
    m.insert("restaurant, chinese, fried rice, without meat", 133.0);
    m.insert("rolled oats", 80.0);
    m.insert(
        "safeway fine granulated sugar, granulated white (ca1) - nfy040y39",
        180.0,
    );
    m.insert(
        "safeway fine granulated sugar, granulated white (ca1) - nfy040y3a",
        177.6,
    );
    m.insert(
        "safeway fine granulated sugar, granulated white (co2) - nfy040y2z",
        192.0,
    );
    m.insert("salsa, pace chunky, medium (al1) - nfy090kiw", 287.2);
    m.insert("salsa, pace chunky, medium (ca1) - nfy090ktf", 305.6);
    m.insert("salsa, pace chunky, medium (ca2) - nfy090ko4", 292.8);
    m.insert("salsa, pace chunky, medium (co1) - nfy090kme", 286.4);
    m.insert("salsa, pace chunky, medium (ct1) - nfy090kj2", 284.0);
    m.insert("salsa, pace chunky, medium (fl1) - nfy090klj", 275.2);
    m.insert("salsa, pace chunky, medium (in1) - nfy090khd", 276.0);
    m.insert("salsa, pace chunky, medium (mi1) - nfy090klh", 273.6);
    m.insert("salsa, pace chunky, medium (mo1) - nfy090kmi", 295.2);
    m.insert("salsa, pace chunky, medium (nc1) - nfy090kiy", 296.0);
    m.insert("salsa, pace chunky, medium (ny1) - nfy090kj0", 264.0);
    m.insert("salsa, pace chunky, medium (ok1) - nfy090kmg", 291.2);
    m.insert("salsa, tostitos chunky - medium", 259.0);
    m.insert("salsa, tostitos chunky, medium (al1) - nfy090kj8", 275.2);
    m.insert("salsa, tostitos chunky, medium (ca1) - nfy090kth", 272.0);
    m.insert("salsa, tostitos chunky, medium (ca2) - nfy090ko6", 308.8);
    m.insert("salsa, tostitos chunky, medium (co1) - nfy090kmc", 269.6);
    m.insert("salsa, tostitos chunky, medium (ct1) - nfy090kj6", 271.2);
    m.insert("salsa, tostitos chunky, medium (fl1) - nfy090kll", 277.6);
    m.insert("salsa, tostitos chunky, medium (in1) - nfy090khf", 290.4);
    m.insert("salsa, tostitos chunky, medium (mi1) - nfy090kln", 314.4);
    m.insert("salsa, tostitos chunky, medium (mo1) - nfy090km8", 275.2);
    m.insert("salsa, tostitos chunky, medium (nc1) - nfy090kja", 285.6);
    m.insert("salsa, tostitos chunky, medium (ny1) - nfy090kj4", 297.6);
    m.insert("salsa, tostitos chunky, medium (ok1) - nfy090kma", 290.4);
    m.insert("salt, essential everyday, iodized", 288.0);
    m.insert("salt, food club, iodized", 283.2);
    m.insert("salt, great value, iodized", 288.0);
    m.insert("salt, heb iodized", 283.2);
    m.insert("salt, hy vee, iodized", 297.6);
    m.insert("salt, laura lynn, iodized", 288.0);
    m.insert("salt, morton, iodized", 316.8);
    m.insert("salt, shop rite, iodized", 302.4);
    m.insert("salt, signature kitchens, iodized", 288.0);
    m.insert("salt, table, iodized", 292.8);
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (al1) - nfy0905jf",
        276.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (ca1) - nfy0905jx",
        286.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (ca2) - nfy0905ke",
        282.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (co2) - nfy0905g8",
        224.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (ct1) - nfy0905gr",
        232.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (fl1) - nfy0905fw",
        246.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (in1) - nfy0905du",
        292.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (mi1) - nfy0905ks",
        294.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (mo1) - nfy0905gi",
        252.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (nc1) - nfy0905kb",
        298.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (ny1) - nfy0905gl",
        278.0,
    );
    m.insert(
        "sauce, pasta, hunts original, canned spaghetti sauce, 26.5 oz container (ok1) - nfy0905ju",
        280.0,
    );
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (al1) - nfy0905jk", 268.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (ca1) - nfy0905k0", 260.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (ca2) - nfy0905kg", 280.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (co2) - nfy0905gc", 242.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (ct1) - nfy0905gv", 262.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (fl1) - nfy0905g2", 294.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (in1) - nfy0905dr", 282.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (mi1) - nfy0905ko", 290.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (mo1) - nfy0905lm", 268.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (nc1) - nfy0905k7", 282.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (ny1) - nfy0905ku", 260.0);
    m.insert("sauce, pasta, prego 100% natural italian, traditional, bottled spaghetti sauce, 24 oz container (ok1) - nfy0905jq", 262.0);
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (al1) - nfy0905ji",
        248.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (ca1) - nfy0905k2",
        260.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (ca2) - nfy0905kk",
        236.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (co2) - nfy0905g5",
        252.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (ct1) - nfy0905gx",
        292.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (fl1) - nfy0905fz",
        308.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (in1) - nfy0905dp",
        232.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (mi1) - nfy0905km",
        270.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (mo1) - nfy0905gf",
        302.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (nc1) - nfy0905k5",
        276.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (ny1) - nfy0905ky",
        266.0,
    );
    m.insert(
        "sauce, pasta, ragu old world, bottled spaghetti sauce, 26 oz container (ok1) - nfy0905jo",
        278.0,
    );
    m.insert("sauce, salsa, ready-to-serve", 285.6);
    m.insert(
        "sausage, pork, chorizo, link or ground, cooked, pan-fried",
        185.0,
    );
    m.insert(
        "seeds, sunflower seed kernels, dry roasted, with salt added",
        127.0,
    );
    m.insert("sour cream", 242.0);
    m.insert("sugars, granulated", 188.0);
    m.insert("sunflower seeds, dry roasted, salted, planters", 126.0);
    m.insert("sunflower seeds, dry roasted, salted, store/other", 134.0);
    m.insert("tomatoes, canned, diced, del monte", 243.0);
    m.insert("tomatoes, canned, diced, great value", 237.0);
    m.insert("tomatoes, canned, diced, hunts", 252.0);
    m.insert("tomatoes, canned, diced, store brand", 234.0);
    m.insert("tomatoes, canned, red, ripe, diced", 245.0);
    m.insert("tomatoes, diced, canned, del monte (co) - nfy120ac3", 227.0);
    m.insert("tomatoes, diced, canned, del monte (ct) - nfy120ac6", 222.0);
    m.insert("tomatoes, diced, canned, del monte (fl) - nfy120acc", 212.0);
    m.insert("tomatoes, diced, canned, del monte (mi) - nfy120ac0", 221.0);
    m.insert("tomatoes, diced, canned, del monte (mo) - nfy120ac9", 219.0);
    m.insert("tomatoes, diced, canned, del monte (nc) - nfy120aci", 214.0);
    m.insert("tomatoes, diced, canned, del monte (ny) - nfy120acl", 225.0);
    m.insert("tomatoes, diced, canned, del monte (ok) - nfy120acf", 236.0);
    m.insert("tomatoes, diced, canned, hunts (al) - nfy120abc", 224.0);
    m.insert("tomatoes, diced, canned, hunts (ca) - nfy120ab9", 218.0);
    m.insert("tomatoes, diced, canned, hunts (ca) - nfy120abo", 225.0);
    m.insert("tomatoes, diced, canned, hunts (co) - nfy120abf", 226.0);
    m.insert("tomatoes, diced, canned, hunts (ct) - nfy120abl", 219.0);
    m.insert("tomatoes, diced, canned, hunts (fl) - nfy120abu", 218.0);
    m.insert("tomatoes, diced, canned, hunts (in) - nfy120abi", 238.0);
    m.insert("tomatoes, diced, canned, hunts (mi) - nfy120ab6", 220.0);
    m.insert("tomatoes, diced, canned, hunts (mo) - nfy120abx", 224.0);
    m.insert("tomatoes, diced, canned, hunts (nc) - nfy120ab3", 224.0);
    m.insert("tomatoes, diced, canned, hunts (ny) - nfy120ab0", 217.0);
    m.insert("tomatoes, diced, canned, hunts (ok) - nfy120abr", 228.0);
    m.insert(
        "tomatoes, diced, canned, store brand, americas choice (ny) - nfy120aak",
        227.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, big daisy (ct) - nfy120aaa",
        221.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, great value (al) - nfy120a9x",
        225.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, great value (al) - nfy120aco",
        222.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, great value (ok) - nfy120acw",
        210.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, hy vee diced tomatoes (mo) - nfy120aa0",
        213.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, hytop premium quality (ca) - nfy120acr",
        223.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, kroger brand (in) - nfy120aap",
        210.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, kroger brand (mi) - nfy120a9s",
        215.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, publix (fl) - nfy120aaf",
        218.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, s&w premium (ca) - nfy120bm8",
        220.0,
    );
    m.insert("tomatoes, diced, canned, store brand, safeway kitchens, 100% natural tomatoes (co) - nfy120aa5", 227.0);
    m.insert(
        "tomatoes, diced, canned, store brand, sunny select (ca) - nfy120ad1",
        229.0,
    );
    m.insert(
        "tomatoes, diced, canned, store brand, vine ripe (nc) - nfy120aau",
        228.0,
    );
    m.insert(
        "tomatoes, diced, canned, value time (ca) - nfy120ad6",
        226.0,
    );
    m.insert("tomatoes, grape", 155.0);
    m.insert("tomatoes, grape, raw", 152.0);
    m.insert("vegetable oil", 218.0);
    m.insert("whole wheat flour", 120.0);

    m
});

/// Aliases mapping common ingredient names to canonical names.
pub static INGREDIENT_ALIASES: LazyLock<HashMap<&'static str, &'static str>> =
    LazyLock::new(|| {
        let mut m = HashMap::new();

        m.insert("ap flour", "all-purpose flour");
        m.insert("canola oil", "vegetable oil");
        m.insert("caster sugar", "granulated sugar");
        m.insert("confectioners sugar", "powdered sugar");
        m.insert("confectioners' sugar", "powdered sugar");
        m.insert("corn starch", "cornstarch");
        m.insert("dark brown sugar", "brown sugar");
        m.insert("double cream", "heavy cream");
        m.insert("dutch process cocoa powder", "cocoa powder");
        m.insert("extra virgin olive oil", "olive oil");
        m.insert("extra-virgin olive oil", "olive oil");
        m.insert("flour", "all-purpose flour");
        m.insert("heavy whipping cream", "heavy cream");
        m.insert("icing sugar", "powdered sugar");
        m.insert("light brown sugar", "brown sugar");
        m.insert("natural cocoa powder", "cocoa powder");
        m.insert("oats", "rolled oats");
        m.insert("oil", "vegetable oil");
        m.insert("old fashioned oats", "rolled oats");
        m.insert("old-fashioned oats", "rolled oats");
        m.insert("packed brown sugar", "brown sugar");
        m.insert("plain flour", "all-purpose flour");
        m.insert("pure maple syrup", "maple syrup");
        m.insert("salted butter", "butter");
        m.insert("sugar", "granulated sugar");
        m.insert("unsalted butter", "butter");
        m.insert("unsweetened cocoa powder", "cocoa powder");
        m.insert("whipping cream", "heavy cream");
        m.insert("white flour", "all-purpose flour");
        m.insert("white sugar", "granulated sugar");
        m.insert("whole milk", "milk");

        m
    });

/// Common modifiers to strip from ingredient names before matching.
const MODIFIERS_TO_STRIP: &[&str] = &[
    // Temperature/state modifiers (prefix)
    "room temperature ",
    "cold ",
    "warm ",
    "melted ",
    "softened ",
    // Preparation modifiers (suffix)
    ", softened",
    ", melted",
    ", cold",
    ", at room temperature",
    ", room temperature",
    ", chilled",
    ", sifted",
];

/// Convert a volume unit to its equivalent in cups.
pub fn volume_to_cups(amount: f64, unit: &str) -> Option<f64> {
    match unit {
        "cup" => Some(amount),
        "tbsp" => Some(amount * CUPS_PER_TBSP),
        "tsp" => Some(amount * CUPS_PER_TSP),
        "fl oz" => Some(amount * CUPS_PER_FL_OZ),
        "pint" => Some(amount * CUPS_PER_PINT),
        "quart" => Some(amount * CUPS_PER_QUART),
        "gallon" => Some(amount * CUPS_PER_GALLON),
        "ml" => Some(amount * CUPS_PER_ML),
        "l" => Some(amount * CUPS_PER_L),
        _ => None,
    }
}

/// Check if a unit is a volume unit we can convert.
pub fn is_volume_unit(unit: Option<&str>) -> bool {
    matches!(
        unit,
        Some("cup")
            | Some("tbsp")
            | Some("tsp")
            | Some("fl oz")
            | Some("pint")
            | Some("quart")
            | Some("gallon")
            | Some("ml")
            | Some("l")
    )
}

/// Find the density (grams per cup) for an ingredient name.
///
/// Tries:
/// 1. Direct lookup in DENSITY_DATA
/// 2. Lookup via INGREDIENT_ALIASES
/// 3. After stripping common modifiers, retry both lookups
pub fn find_density(ingredient_item: &str) -> Option<f64> {
    let normalized = normalize_ingredient_name(ingredient_item);

    // Direct lookup
    if let Some(&density) = DENSITY_DATA.get(normalized.as_str()) {
        return Some(density);
    }

    // Alias lookup
    if let Some(&canonical) = INGREDIENT_ALIASES.get(normalized.as_str()) {
        if let Some(&density) = DENSITY_DATA.get(canonical) {
            return Some(density);
        }
    }

    // Try with modifiers stripped
    let stripped = strip_modifiers(&normalized);
    if stripped != normalized {
        if let Some(&density) = DENSITY_DATA.get(stripped.as_str()) {
            return Some(density);
        }
        if let Some(&canonical) = INGREDIENT_ALIASES.get(stripped.as_str()) {
            if let Some(&density) = DENSITY_DATA.get(canonical) {
                return Some(density);
            }
        }
    }

    None
}

/// Normalize ingredient name for matching.
fn normalize_ingredient_name(s: &str) -> String {
    s.to_lowercase().trim().to_string()
}

/// Strip common modifiers from ingredient name.
fn strip_modifiers(s: &str) -> String {
    let mut result = s.to_string();
    for modifier in MODIFIERS_TO_STRIP {
        if let Some(stripped) = result.strip_prefix(modifier) {
            result = stripped.to_string();
        }
        if let Some(stripped) = result.strip_suffix(modifier) {
            result = stripped.to_string();
        }
    }
    result
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_find_density_direct() {
        // These should find densities (exact names from USDA)
        assert!(find_density("cheese, cheddar").is_some());
    }

    #[test]
    fn test_find_density_alias() {
        // Common aliases should work
        assert!(find_density("flour").is_some());
        assert!(find_density("sugar").is_some());
        assert!(find_density("butter").is_some());
    }

    #[test]
    fn test_find_density_with_modifiers() {
        assert!(find_density("softened butter").is_some());
        assert!(find_density("melted butter").is_some());
    }

    #[test]
    fn test_find_density_case_insensitive() {
        assert!(find_density("FLOUR").is_some());
        assert!(find_density("Butter").is_some());
    }

    #[test]
    fn test_find_density_unknown() {
        assert_eq!(find_density("unicorn tears"), None);
        assert_eq!(find_density("mystery powder"), None);
    }

    #[test]
    fn test_volume_to_cups() {
        assert_eq!(volume_to_cups(1.0, "cup"), Some(1.0));
        assert_eq!(volume_to_cups(16.0, "tbsp"), Some(1.0));
        assert_eq!(volume_to_cups(48.0, "tsp"), Some(1.0));
        assert_eq!(volume_to_cups(8.0, "fl oz"), Some(1.0));
        assert_eq!(volume_to_cups(0.5, "pint"), Some(1.0));
    }

    #[test]
    fn test_is_volume_unit() {
        assert!(is_volume_unit(Some("cup")));
        assert!(is_volume_unit(Some("tbsp")));
        assert!(is_volume_unit(Some("tsp")));
        assert!(!is_volume_unit(Some("oz")));
        assert!(!is_volume_unit(Some("lb")));
        assert!(!is_volume_unit(Some("g")));
        assert!(!is_volume_unit(None));
    }
}
